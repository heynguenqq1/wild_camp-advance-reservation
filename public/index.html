<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì™€ì¼ë“œ ìº í”„ - ì‚¬ì „ì˜ˆì•½</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
    input, button { padding: 10px; font-size: 16px; margin: 10px; }
    ul { list-style: none; padding: 0; }
    #nicknameList { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>ğŸ® ì™€ì¼ë“œ ìº í”„ ì‚¬ì „ì˜ˆì•½ ğŸ®</h1>
  <p>ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ê³  ë‹¨ í•œ ë²ˆì˜ ì‚¬ì „ì˜ˆì•½ ê¸°íšŒë¥¼ ì¡ìœ¼ì„¸ìš”!</p>

  <div id="reserveForm">
    <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" required />
    <button type="submit" id="reserveBtn">ì‚¬ì „ì˜ˆì•½</button>
  </div>

  <h2>ğŸ“œ ì‚¬ì „ì˜ˆì•½ì ëª©ë¡</h2>
  <ul id="nicknameList"></ul>

  <script>
    // ì´ë¯¸ ì‚¬ì „ì˜ˆì•½ í–ˆëŠ”ì§€ í™•ì¸(localStorage ì‚¬ìš©)
    const reserved = localStorage.getItem("wildcamp_reserved");
    if (reserved) {
      document.getElementById("reserveForm").innerHTML =
        "<p>âœ… ì´ë¯¸ ì‚¬ì „ì˜ˆì•½ì„ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤.</p>";
    }

    document.getElementById("reserveBtn")?.addEventListener("click", async (e) => {
      e.preventDefault();
      const nickname = document.getElementById("nickname").value.trim();
      if (!nickname) {
        alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      // ì„œë²„ì— ë‹‰ë„¤ì„ ë³´ë‚´ê¸° (fetch)
      try {
        const response = await fetch("/api/reserve", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nickname })
        });

        if (response.ok) {
          localStorage.setItem("wildcamp_reserved", "true");
          document.getElementById("reserveForm").innerHTML =
            "<p>ğŸ‰ ì‚¬ì „ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</p>";
          loadNicknames();
        } else if (response.status === 409) {
          alert("ì´ë¯¸ ë“±ë¡ëœ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
        } else if (response.status === 400) {
          alert("ë‹‰ë„¤ì„ì´ ì œëŒ€ë¡œ ì „ì†¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        } else {
          alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        }
      } catch (error) {
        alert("ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        console.error(error);
      }
    });

    // ì‚¬ì „ì˜ˆì•½ì ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadNicknames() {
      try {
        const res = await fetch("/api/list");
        if (res.ok) {
          const list = await res.json();
          const ul = document.getElementById("nicknameList");
          ul.innerHTML = "";
          list.forEach(nick => {
            const li = document.createElement("li");
            li.textContent = nick;
            ul.appendChild(li);
          });
        } else {
          document.getElementById("nicknameList").innerHTML = "<li>ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>";
        }
      } catch (e) {
        document.getElementById("nicknameList").innerHTML = "<li>ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>";
      }
    }
    loadNicknames();
  </script>
</body>
</html>
